{"version":3,"file":"angular-google-tag-manager.js","sources":["../../projects/angular-google-tag-manager/src/lib/angular-google-tag-manager.service.ts","../../projects/angular-google-tag-manager/src/lib/angular-google-tag-manager.module.ts","../../projects/angular-google-tag-manager/src/lib/google-tag-manager-config.ts"],"names":[],"mappings":";;;;;;;;MAMa,uBAAuB;AACpC;AAAQ;AAEH;AACS;AAGX;AACkB;AACf,IAGJ,YAGS,SAAiC,EAAE,EAAE,EAAE,IAAI,EAAE,EACH,kBAA0B,EAGpE,oBAA4B,EAG5B,uBAA+B;AACvC,QARQ,WAAM,GAAN,MAAM,CAAuC;AAAC,QACJ,uBAAkB,GAAlB,kBAAkB,CAAQ;AAAC,QAGrE,yBAAoB,GAApB,oBAAoB,CAAQ;AAAC,QAG7B,4BAAuB,GAAvB,uBAAuB,CAAQ;AAC1C,QAtBU,aAAQ,GAAG,KAAK,CAAC;AAC3B,QACU,mBAAc,GAAG;AAC3B;AAAgB;AACI;AAEZ,YAHJ,SAAS;AAAK,gBACZ,OAAO,MAAM,CAAC;AACpB,aAAK;AACL;AAAgB;AACE;AAEd,YAHA,WAAW;AAAK,gBACd,OAAO,QAAQ,CAAC;AACtB,aAAK;AACL,SAAG,CAAC;AACJ,QAaI,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,EAAE;AAC7B,YAAM,IAAI,CAAC,MAAM,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC;AACjC,SAAK;AACL,QACI,IAAI,CAAC,MAAM,mCACN,IAAI,CAAC,MAAM,KACd,EAAE,EAAE,kBAAkB,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,EACxC,QAAQ,EAAE,oBAAoB,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,EACtD,WAAW,EAAE,uBAAuB,IAAI,IAAI,CAAC,MAAM,CAAC,WAAW,GAChE,CAAC;AACN,QAAI,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,IAAI,EAAE;AAChC,YAAM,MAAM,IAAI,KAAK,CAAC,qCAAqC,CAAC,CAAC;AAC7D,SAAK;AACL,KAAG;AACH;AACO;AAAmB;AACzB,IADQ,YAAY;AAAK;AACR,cAAR,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE;AAClD,QAAI,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,IAAI,EAAE,CAAC;AAC9C,QAAI,OAAO,MAAM,CAAC,SAAS,CAAC;AAC5B,KAAG;AACH;AACO;AAAgB;AAAsB;AAC5B;AAAQ,IADf,eAAe,CAAC,GAAW;AAAI;AACtB,cAAT,SAAS,GAAG,IAAI,CAAC,YAAY,EAAE;AACzC,QAAI,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACxB,KAAG;AACH;AACO;AAAmB;AAAQ,IAAzB,WAAW;AAAK,QACrB,OAAO,IAAI,OAAO;AAAM;AAChB;AACE;AAAuB;AAEnC,QAJqB,CAAC,OAAO,EAAE,MAAM;AACvC,YAAM,IAAI,IAAI,CAAC,QAAQ,EAAE;AACzB,gBAAQ,OAAO,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACtC,aAAO;AACP;AAA6B,kBAAjB,GAAG,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE;AACnD,YAAM,IAAI,CAAC,eAAe,CAAC;AAC3B,gBAAQ,WAAW,EAAE,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;AACzC,gBAAQ,KAAK,EAAE,QAAQ;AACvB,aAAO,CAAC,CAAC;AACT;AAC4B,kBAAhB,SAAS,GAAG,GAAG,CAAC,aAAa,CAAC,QAAQ,CAAC;AACnD,YAAM,SAAS,CAAC,EAAE,GAAG,WAAW,CAAC;AACjC,YAAM,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC;AAC7B,YAAM,SAAS,CAAC,GAAG,GAAG,IAAI,CAAC,mBAAmB,CACtC,yCAAyC,CAC1C,CAAC;AACR,YAAM,SAAS,CAAC,gBAAgB,CAAC,MAAM;AAAO;AACtB;AAAgB,YADC;AACzC,gBAAQ,OAAO,OAAO,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;AAC7C,aAAO,EAAC,CAAC;AACT,YAAM,SAAS,CAAC,gBAAgB,CAAC,OAAO;AAAO;AACvB;AAExB,YAH0C;AAC1C,gBAAQ,OAAO,MAAM,CAAC,KAAK,CAAC,CAAC;AAC7B,aAAO,EAAC,CAAC;AACT,YAAM,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC5D,SAAK,EAAC,CAAC;AACP,KAAG;AACH;AACO;AAAuB;AAC7B;AAAQ,IADA,OAAO,CAAC,IAAY;AAAI,QAC7B,OAAO,IAAI,OAAO;AAAM;AACtB;AACC;AAAuB;AAC5B,QAH2B,CAAC,OAAO,EAAE,MAAM;AAC7C,YAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;AAC1B,gBAAQ,IAAI,CAAC,WAAW,EAAE,CAAC,IAAI;AAAM;AACT;AAClB,gBAFsB;AAChC,oBAAU,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;AACrC,oBAAU,OAAO,OAAO,EAAE,CAAC;AAC3B,iBAAS,EAAC,CAAC,KAAK;AAAM;AAEX;AAAoB,gBAFd,MAAM,MAAM,EAAE,EAAC,CAAC;AACjC,aAAO;AACP,YAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;AACjC,YAAM,OAAO,OAAO,EAAE,CAAC;AACvB,SAAK,EAAC,CAAC;AACP,KAAG;AACH;AACO;AAAgB;AAAsB;AAClC;AAAQ,IADT,mBAAmB,CAAC,GAAW;AAAI,QACzC,IAAI,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;AACjC,YAAM,GAAG,IAAI,GAAG,CAAC;AACjB,SAAK;AACL,QACI,QACE,GAAG;AACT,YAAM,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;AAC9B,iBAAS,MAAM;AAAM;AACX;AAA2B;AAC9B,YAFS,CAAC,CAAC,KAAK,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAC;AACtC,iBAAS,GAAG;AAAM;AAClB;AAEC;AAEU,YALE,CAAC,CAAC,KAAK,GAAG,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAC;AAC7C,iBAAS,IAAI,CAAC,GAAG,CAAC,EACZ;AACN,KAAG;AACH;mDA1GC,UAAU,SAAC,kBACV,UAAU,EAAE,MAAM,eACnB,oLACI;AAAC;AAAmB;AAGnB,4CAUD,QAAQ,YACR,MAAM,SAAC,wBAAwB;AAC7B,yCACF,QAAQ,YAAI,MAAM,SAAC,oBAAoB;AAAS,yCAChD,QAAQ,YACR,MAAM,SAAC,sBAAsB;AAC3B,yCACF,QAAQ,YACR,MAAM,SAAC,yBAAyB;AAC/B;AAAG;;;;;;;;;;;;;;;;;;;;;;;;;;kCAYmB;AAAC;AACrB;AAAQ;AAAiB;AAAgB;AAAQ,IAlCvD,2CAAyB;AAC3B;AACO;AAAiB;AACb;AAAQ,IADjB,iDAOE;AACJ;AAEK,IAAD,yCAEoD;AAAC;AACrC,IAAhB,qDAA2E;AAAC;AAE5E,IADA,uDAEmC;AAAC;AAEpC,IADA,0DAEsC;AAC1C;AAAE;AAAC;AACF;AACG;AAID;AAGiB;AAAI,MClCX,sBAAsB;AACnC;AAAQ;AACA;AAAmB;AAC3B,IAFS,OAAO,OAAO,CACnB,MAA8B;AAC/B,QACC,OAAO;AACX,YAAM,QAAQ,EAAE,sBAAsB;AACtC,YAAM,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,wBAAwB,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC;AAC1E,SAAK,CAAC;AACN,KAAG;AACH;kDAVC,QAAQ;;;;;0BACP;AAAC;AAAC;AAAI;AACJ;AAC2B;AAIU;AAAI;AAAI;AAAW;AAAI,qCCL/D;AACD;AAAa;AAAqB,IALhC,oCAAkB;AACpB;AACU,IADR,0CAAkB;AACpB;AACO,IADL,6CAAqB;AACvB;AAEgC;AAAE;AAAC;AAAI;AAAkC;AAAiC;AAAqJ;AAAI;AAAC;AAAI;AAAkC;AAAiD;AAAqJ;AAAI;AAAC;AAA4D","sourcesContent":["import { Inject, Injectable, Optional } from '@angular/core';\nimport { GoogleTagManagerConfig } from './google-tag-manager-config';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class GoogleTagManagerService {\n  private isLoaded = false;\n\n  private browserGlobals = {\n    windowRef(): any {\n      return window;\n    },\n    documentRef(): any {\n      return document;\n    },\n  };\n\n  constructor(\n    @Optional()\n    @Inject('googleTagManagerConfig')\n    public config: GoogleTagManagerConfig = { id: null },\n    @Optional() @Inject('googleTagManagerId') public googleTagManagerId: string,\n    @Optional()\n    @Inject('googleTagManagerAuth')\n    public googleTagManagerAuth: string,\n    @Optional()\n    @Inject('googleTagManagerPreview')\n    public googleTagManagerPreview: string\n  ) {\n    if (this.config == null) {\n      this.config = { id: null };\n    }\n\n    this.config = {\n      ...this.config,\n      id: googleTagManagerId || this.config.id,\n      gtm_auth: googleTagManagerAuth || this.config.gtm_auth,\n      gtm_preview: googleTagManagerPreview || this.config.gtm_preview,\n    };\n    if (this.config.id == null) {\n      throw new Error('Google tag manager ID not provided.');\n    }\n  }\n\n  public getDataLayer(): any[] {\n    const window = this.browserGlobals.windowRef();\n    window.dataLayer = window.dataLayer || [];\n    return window.dataLayer;\n  }\n\n  private pushOnDataLayer(obj: object): void {\n    const dataLayer = this.getDataLayer();\n    dataLayer.push(obj);\n  }\n\n  public addGtmToDom(): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      if (this.isLoaded) {\n        return resolve(this.isLoaded);\n      }\n      const doc = this.browserGlobals.documentRef();\n      this.pushOnDataLayer({\n        'gtm.start': new Date().getTime(),\n        event: 'gtm.js',\n      });\n\n      const gtmScript = doc.createElement('script');\n      gtmScript.id = 'GTMscript';\n      gtmScript.async = true;\n      gtmScript.src = this.applyGtmQueryParams(\n        'https://www.googletagmanager.com/gtm.js'\n      );\n      gtmScript.addEventListener('load', () => {\n        return resolve(this.isLoaded = true);\n      });\n      gtmScript.addEventListener('error', () => {\n        return reject(false);\n      });\n      doc.head.insertBefore(gtmScript, doc.head.firstChild);\n    });\n  }\n\n  public pushTag(item: object): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      if (!this.isLoaded) {\n        this.addGtmToDom().then(() => {\n          this.pushOnDataLayer(item);\n          return resolve();\n        }).catch(() => reject());\n      }\n      this.pushOnDataLayer(item);\n      return resolve();\n    });\n  }\n\n  private applyGtmQueryParams(url: string): string {\n    if (url.indexOf('?') === -1) {\n      url += '?';\n    }\n\n    return (\n      url +\n      Object.keys(this.config)\n        .filter((k) => this.config[k])\n        .map((k) => `${k}=${this.config[k]}`)\n        .join('&')\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { GoogleTagManagerConfig } from './google-tag-manager-config';\n\n@NgModule()\nexport class GoogleTagManagerModule {\n  public static forRoot(\n    config: GoogleTagManagerConfig\n  ): ModuleWithProviders<GoogleTagManagerModule> {\n    return {\n      ngModule: GoogleTagManagerModule,\n      providers: [{ provide: 'googleTagManagerConfig', useValue: config }],\n    };\n  }\n}\n","export interface GoogleTagManagerConfig {\n  id: string | null;\n  gtm_auth?: string;\n  gtm_preview?: string;\n  [key: string]: string | null | undefined;\n}\n"]}